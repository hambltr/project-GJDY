<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="참 잘했어요! 잘했도요.">
    <meta name="keywords" content="도전,챌린지,도전모임,결심,목표,동기부여,노력,새해목표,올해목표,새해맞이">


    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <link rel="stylesheet" type="text/css" href="https://npmcdn.com/flatpickr/dist/themes/confetti.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ko.js"></script>

    <link href="https://hangeul.pstatic.net/hangeul_static/css/NanumHarABeoJiEuiNaNum.css" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="chalManagerDetail.css">

    <title>MY 챌린지 관리</title>
    <link rel="icon" href="../icon/favicon.ico">
</head>

<body>
    <section class="view">
        <!-- <div id="header"></div> -->
        <section>
            <div class="contents-wrap">

                <div class="page active">
                    <div class="mychal-detail">
                        <div class="mychal-info">
                            <span>
                                <h3>물 50잔 마시기</h3>
                                <h4>평일 매일</h4>
                                <h5>23.12.21(목) ~ 23.12.31(일)</h5>
                                <h6>100% 달성</h6>
                            </span>
                        </div>
                    </div>

                    <div class="mychal-titles">
                        <h1>오늘의 참여 현황<span>3/500</span></h1><button onclick="showPage('userconfirmArea')">승인하러 가기
                            →</button>
                    </div>
                    <div class="chalconfirm check">확인해야 할 인증이 있어요.</div>
                    <div class="chalconfirm finish">인증을 모두 확인했어요.</div>

                    <div class="mychal-titles">
                        <h1>참가자 인증 모아보기</h1>
                    </div>
                    <div class="user-photo">
                        <div onclick="showUserPhoto()"><img src="./profile_3.png"></div>
                        <div><img src="./profile_2.png"></div>
                        <div><img src=""></div>
                        <div><img src=""></div>
                        <div><img src=""></div>
                        <div><img src=""></div>
                        <div><img src=""></div>
                        <div><img src=""></div>
                        <div><img src=""></div>
                        <div><img src=""></div>
                        <div><img src=""></div>
                    </div>

                    <div id="ChalUserdetail" class="hide layer">
                        <div class="chaluser-detail">
                            <img src="./profile_3.png">
                            <div class="picture-title">YYYY-MM-DD<button onclick="closeUserPhoto()">닫기</button></div>
                        </div>
                    </div>
                </div>

                <div class="userconfirm-area page" id="userconfirmArea">
                    <h3>물 500잔 마시기</h3>

                    <div class="user-confirm">
                        <img src="./icon/goodjob_cat.png" onclick="showPopup('confirmDetail');">
                        <div class="confirm-text">
                            <h3 onclick="showPopup('confirmDetail');">김도요</h3>
                            <span>
                                <button onclick="showPopup('confirmFinal');">✅</button>
                                <button onclick="showPopup('confirmRefuse');">❌</button>
                            </span>
                            <h5>내용내내용내용내용,,ㅇ쩌고저쩌고,,용내용,,ㅇ쩌고저쩌고,,</h5>
                        </div>
                    </div>


                    <!-- 유저 인증 상세 -->

                    <div id="confirmDetail" class="layer hide">
                        <div class="confirm-detail">
                            <button id="chalcancel" onclick="closePopup('confirmDetail');">X</button>
                            <h3>상세</h3>
                            <img src="./profile_4.jpg">
                            <h5>내용내용내용~~~~블라블라<br>어쩌고저쩌고</h5>
                            <button id="chalaccept" onclick="showPopup('confirmFinal');">승인</button>
                            <button id="chalrefuse" onclick="showPopup('confirmRefuse');">반려</button>
                        </div>
                    </div>


                    <!-- 유저 승인 최종 -->
                    <div id="confirmFinal" class="layer hide">
                        <div class="confirm-final">
                            <h3>인증 승인</h3>
                            <h5>승인 후에는 철회할 수 없으니 신중하게 처리해 주세요.</h5>
                            <button id="chalaccept">승인</button>
                            <button id="chalcancel" onclick="closePopup('confirmFinal');">취소</button>
                        </div>
                    </div>

                    <!-- 유저 반려 최종 -->
                    <div id="confirmRefuse" class="layer hide">
                        <div class="confirm-final">
                            <h3>인증 반려</h3>
                            <textarea id="refuse-message" name="refuse-message" placeholder="사유를 10글자 이상 입력하세요. (필수)"
                                required></textarea><br>
                            <h5>반려 후에는 철회할 수 없으니 신중하게 처리해 주세요!</h5>
                            <button id="chalrefuse">반려</button>
                            <button id="chalcancel" onclick="closePopup('confirmRefuse');">취소</button>
                        </div>
                    </div>

                </div>

            </div>
        </section>

    </section>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>

    <script>
        $(function () {
            $("#header").load("./header.html");
        });


        document.addEventListener('DOMContentLoaded', function () {
            var confirmCount = 1;

            var checkDiv = document.querySelector('.chalconfirm.check');
            var finishDiv = document.querySelector('.chalconfirm.finish');

            if (confirmCount === 0) {
                finishDiv.style.display = 'block';
            } else {
                checkDiv.style.display = 'block';
            }
        });


        //컨펌하러 가기(페이지 이동)
        function showPage(pageId) {
            var currentPage = $(".active");
            currentPage.removeClass("active");

            var nextPage = $("#" + pageId);
            nextPage.addClass("active");
        }


        //이미지 레이어 팝업
        function showUserPhoto() {
            document.querySelector('#ChalUserdetail').classList.remove('hide');
        }

        function closeUserPhoto() {
            document.querySelector('#ChalUserdetail').classList.add('hide');
        }

        $(document).mouseup(function (e) {

            var popContent = $('#ChalUserdetail');

            if (popContent.has(e.target).length === 0) {
                popContent.addClass('hide');

            }
        });

        // 유저 컨펌 레이어 팝업 관련 스크립트
        var popupStack = []; // 팝업 스택

        function showPopup(popupId) {
            popupStack.push(popupId);
            document.getElementById(popupId).classList.remove('hide');
        }

        function closePopup(popupId) {
            document.getElementById(popupId).classList.add('hide');
        }

        document.addEventListener('keydown', function (e) {
            if (e.key === "Escape") {
                var recentPopup = popupStack.pop();
                if (recentPopup) {
                    closePopup(recentPopup);
                }
            }
        });

        // 취소 버튼 클릭 시 해당 팝업만 닫도록 수정
        $('.confirm-final button[id$="cancel"]').click(function () {
            var recentPopup = popupStack.pop();
            if (recentPopup) {
                closePopup(recentPopup);
            }
        });
    </script>
</body>

</html>